<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Movimientos - Educonta</title>
    <link rel="stylesheet" href="css/accounting-dashboard.css">
    <link rel="stylesheet" href="css/approval-status.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS del sidebar complejo removido - ahora usa sidebar unificado */
    </style>
</head>

<body>
    <div class="app-container">
        <!-- SIDEBAR -->
                <!-- SIDEBAR UNIFICADO -->
        <aside class="sidebar">
            <!-- El contenido se cargará dinámicamente con sidebar.js -->
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title">💰 Gestión de Movimientos</h1>
                    <p class="page-subtitle">Transacciones contables y plan de cuentas</p>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="exportMovementsReport()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6z" />
                            </svg>
                            Exportar
                        </button>
                        <button class="btn btn-secondary" onclick="showAccountsModal()">
                            <svg width="16" height="16" fill="currentColor">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                            </svg>
                            Plan de Cuentas
                        </button>
                        <button class="btn btn-primary" onclick="showNewTransactionModal()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            Nueva Transacción
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- TABS NAVIGATION -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-btn active" data-tab="transactions" onclick="switchTab('transactions')">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Transacciones
                        </button>
                        <button class="tab-btn" data-tab="accounts" onclick="switchTab('accounts')">
                            <svg width="16" height="16" fill="currentColor">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                            </svg>
                            Plan de Cuentas
                        </button>
                        <button class="tab-btn" data-tab="reports" onclick="switchTab('reports')">
                            <svg width="16" height="16" fill="currentColor">
                                <path
                                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                            </svg>
                            Reportes
                        </button>
                    </div>
                </div>

                <!-- TRANSACTIONS TAB -->
                <div class="tab-content active" id="transactions-tab">
                    <!-- FILTERS -->
                    <div class="filters-section">
                        <div class="filters-container">
                            <div class="filter-group">
                                <label>Fecha desde:</label>
                                <input type="date" id="dateFrom" onchange="filterTransactions()">
                            </div>
                            <div class="filter-group">
                                <label>Fecha hasta:</label>
                                <input type="date" id="dateTo" onchange="filterTransactions()">
                            </div>
                            <div class="filter-group">
                                <label>Tipo:</label>
                                <select id="typeFilter" onchange="filterTransactions()">
                                    <option value="">Todos</option>
                                    <option value="INCOME">Ingresos</option>
                                    <option value="EXPENSE">Gastos</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Estado:</label>
                                <select id="statusFilter" onchange="filterTransactions()">
                                    <option value="">Todos</option>
                                    <option value="APPROVED">Aprobadas</option>
                                    <option value="PENDING">Pendientes</option>
                                </select>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="clearFilters()">Limpiar</button>
                        </div>
                    </div>

                    <!-- TRANSACTIONS LIST -->
                    <div class="transactions-container">
                        <div class="transactions-header">
                            <h3>Lista de Transacciones</h3>
                            <div class="transactions-summary" id="transactionsSummary">
                                <span class="summary-item">Total: <strong id="totalTransactions">0</strong></span>
                                <span class="summary-item">Ingresos: <strong id="totalIncome">$0</strong></span>
                                <span class="summary-item">Gastos: <strong id="totalExpenses">$0</strong></span>
                            </div>
                        </div>

                        <div class="transactions-table-container">
                            <table class="transactions-table" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Referencia</th>
                                        <th>Descripción</th>
                                        <th>Cuenta Débito</th>
                                        <th>Cuenta Crédito</th>
                                        <th>Monto</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <tr class="loading-row">
                                        <td colspan="8">
                                            <div class="loading-spinner"></div>
                                            <span>Cargando transacciones...</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ACCOUNTS TAB -->
                <div class="tab-content" id="accounts-tab">
                    <div class="accounts-container">
                        <div class="accounts-header">
                            <h3>Plan de Cuentas</h3>
                            <button class="btn btn-primary btn-sm" onclick="showNewAccountModal()">
                                <svg width="16" height="16" fill="currentColor">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                </svg>
                                Nueva Cuenta
                            </button>
                        </div>

                        <div class="accounts-tree" id="accountsTree">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Cargando plan de cuentas...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- REPORTS TAB -->
                <div class="tab-content" id="reports-tab">
                    <div class="reports-container">
                        <div class="reports-grid">
                            <div class="report-card">
                                <div class="report-icon">
                                    <svg width="24" height="24" fill="currentColor">
                                        <path
                                            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                    </svg>
                                </div>
                                <h3>Balance General</h3>
                                <p>Estado de situación financiera</p>
                                <button class="btn btn-outline" onclick="generateBalanceSheet()">Generar</button>
                            </div>

                            <div class="report-card">
                                <div class="report-icon">
                                    <svg width="24" height="24" fill="currentColor">
                                        <path
                                            d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6z" />
                                    </svg>
                                </div>
                                <h3>Estado de Resultados</h3>
                                <p>Ingresos y gastos del período</p>
                                <button class="btn btn-outline" onclick="generateIncomeStatement()">Generar</button>
                            </div>

                            <div class="report-card">
                                <div class="report-icon">
                                    <svg width="24" height="24" fill="currentColor">
                                        <path
                                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                    </svg>
                                </div>
                                <h3>Libro Diario</h3>
                                <p>Registro cronológico de transacciones</p>
                                <button class="btn btn-outline" onclick="generateJournal()">Generar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="js/accounting/globals.js"></script>
    <script src="js/accounting/state.js"></script>
    <script src="js/accounting/demo-data.js"></script>
    <script src="js/accounting/movements-page.js"></script>
    <!-- Scripts de diagnóstico comentados para evitar ejecución automática
    <script src="diagnostico-movimientos.js"></script>
    <script src="test-invoice-button.js"></script>
    <script src="test-modal-simple.js"></script>
    <script src="debug-view-transaction.js"></script>
    -->
    </script>

    <script>
        // Inicialización específica de la página
        let movementsPage;

        // Función de sidebar removida - ahora usa sidebar unificado
        
        function initializeTheme() {
            // Aplicar tema guardado
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            // Sidebar unificado se inicializa automáticamente
            movementsPage = new MovementsManagementPage();
            // Hacer disponible globalmente
            window.movementsPage = movementsPage;
        });

        // Funciones globales para la página
        function switchTab(tabName) {
            if (movementsPage) {
                movementsPage.switchTab(tabName);
            }
        }

        function filterTransactions() {
            if (movementsPage) {
                movementsPage.filterTransactions();
            }
        }

        function clearFilters() {
            if (movementsPage) {
                movementsPage.clearFilters();
            }
        }

        function showNewTransactionModal() {
            if (movementsPage) {
                movementsPage.showNewTransactionModal();
            }
        }

        function showAccountsModal() {
            if (movementsPage) {
                movementsPage.showAccountsModal();
            }
        }

        function showNewAccountModal() {
            if (movementsPage) {
                movementsPage.showNewAccountModal();
            }
        }

        function exportMovementsReport() {
            if (movementsPage) {
                movementsPage.exportReport();
            }
        }

        function generateBalanceSheet() {
            if (movementsPage) {
                movementsPage.generateBalanceSheet();
            }
        }

        function generateIncomeStatement() {
            if (movementsPage) {
                movementsPage.generateIncomeStatement();
            }
        }

        function generateJournal() {
            if (movementsPage) {
                movementsPage.generateJournal();
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Actualizar labels
            const lightLabel = document.getElementById('light-label');
            const darkLabel = document.getElementById('dark-label');

            if (lightLabel && darkLabel) {
                lightLabel.classList.toggle('active', newTheme === 'light');
                darkLabel.classList.toggle('active', newTheme === 'dark');
            }

            console.log(`🎨 Tema cambiado a: ${newTheme}`);
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // Actualizar labels
            const lightLabel = document.getElementById('light-label');
            const darkLabel = document.getElementById('dark-label');

            if (lightLabel && darkLabel) {
                lightLabel.classList.toggle('active', savedTheme === 'light');
                darkLabel.classList.toggle('active', savedTheme === 'dark');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

    </script>
    <script src="js/shared/sidebar.js"></script>
</body>

</html>