<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Deudas y Abonos - Educonta</title>
    <link rel="stylesheet" href="css/accounting-dashboard.css">
    <link rel="stylesheet" href="css/approval-status.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
                <!-- SIDEBAR UNIFICADO -->
        <aside class="sidebar">
            <!-- El contenido se cargar√° din√°micamente con sidebar.js -->
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title">üí≥ Gesti√≥n de Deudas y Abonos</h1>
                    <p class="page-subtitle">Control de pagos y seguimiento de estudiantes</p>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="exportDebtsReport()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6z"/>
                            </svg>
                            Exportar Reporte
                        </button>
                        <button class="btn btn-primary" onclick="showNewDebtModal()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            Nueva Deuda
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- STATS CARDS -->
                <div class="stats-grid">
                    <div class="stat-card overdue">
                        <div class="stat-icon">
                            <svg width="24" height="24" fill="currentColor">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-title">Deudas Vencidas</h3>
                            <p class="stat-value" id="overdueCount">0</p>
                            <span class="stat-change negative">Requieren atenci√≥n</span>
                        </div>
                    </div>

                    <div class="stat-card pending">
                        <div class="stat-icon">
                            <svg width="24" height="24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-title">Deudas Pendientes</h3>
                            <p class="stat-value" id="pendingCount">0</p>
                            <span class="stat-change">En plazo</span>
                        </div>
                    </div>

                    <div class="stat-card partial">
                        <div class="stat-icon">
                            <svg width="24" height="24" fill="currentColor">
                                <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-title">Abonos Parciales</h3>
                            <p class="stat-value" id="partialCount">0</p>
                            <span class="stat-change positive">Con pagos</span>
                        </div>
                    </div>

                    <div class="stat-card amount">
                        <div class="stat-icon">
                            <svg width="24" height="24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-title">Total Adeudado</h3>
                            <p class="stat-value" id="totalDebt">$0</p>
                            <span class="stat-change">Monto pendiente</span>
                        </div>
                    </div>
                </div>

                <!-- FILTERS -->
                <div class="filters-section">
                    <div class="filters-header">
                        <h3>Filtros</h3>
                        <button class="btn btn-outline btn-sm" onclick="clearAllFilters()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            Limpiar
                        </button>
                    </div>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Estado:</label>
                            <select id="statusFilter" onchange="applyFilters()">
                                <option value="">Todos</option>
                                <option value="OVERDUE">üö® Vencidas</option>
                                <option value="PENDING">‚è≥ Pendientes</option>
                                <option value="PARTIAL">üí∞ Parciales</option>
                                <option value="PAID">‚úÖ Pagadas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Grado:</label>
                            <select id="gradeFilter" onchange="applyFilters()">
                                <option value="">Todos los grados</option>
                                <option value="11¬∞">11¬∞ Grado</option>
                                <option value="10¬∞">10¬∞ Grado</option>
                                <option value="9¬∞">9¬∞ Grado</option>
                                <option value="8¬∞">8¬∞ Grado</option>
                                <option value="7¬∞">7¬∞ Grado</option>
                                <option value="6¬∞">6¬∞ Grado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Concepto:</label>
                            <select id="conceptFilter" onchange="applyFilters()">
                                <option value="">Todos los conceptos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Buscar estudiante:</label>
                            <input type="text" id="searchFilter" placeholder="Nombre del estudiante..." onkeyup="applyFilters()">
                        </div>
                    </div>
                </div>

                <!-- DEBTS GRID -->
                <div class="debts-container">
                    <div class="debts-grid" id="debtsGrid">
                        <div class="loading-state" id="loadingState">
                            <div class="loading-spinner"></div>
                            <p>Cargando deudas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="js/accounting/globals.js"></script>
    <script src="js/accounting/state.js"></script>
    <script src="js/accounting/debt-management.js"></script>
    <script src="js/accounting/debts-page.js"></script>
    
    <script>
        // Inicializaci√≥n espec√≠fica de la p√°gina
        let debtsPage;
        
        document.addEventListener('DOMContentLoaded', () => {
            debtsPage = new DebtsManagementPage();
        });

        // Funciones globales para la p√°gina
        function applyFilters() {
            if (debtsPage) {
                debtsPage.applyFilters();
            }
        }

        function clearAllFilters() {
            if (debtsPage) {
                debtsPage.clearFilters();
            }
        }

        function showNewDebtModal() {
            if (debtsPage) {
                debtsPage.showNewDebtModal();
            }
        }

        function exportDebtsReport() {
            if (debtsPage) {
                debtsPage.exportReport();
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Actualizar labels
            const lightLabel = document.getElementById('light-label');
            const darkLabel = document.getElementById('dark-label');
            
            if (lightLabel && darkLabel) {
                lightLabel.classList.toggle('active', newTheme === 'light');
                darkLabel.classList.toggle('active', newTheme === 'dark');
            }
            
            console.log(`üé® Tema cambiado a: ${newTheme}`);
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Actualizar labels
            const lightLabel = document.getElementById('light-label');
            const darkLabel = document.getElementById('dark-label');
            
            if (lightLabel && darkLabel) {
                lightLabel.classList.toggle('active', savedTheme === 'light');
                darkLabel.classList.toggle('active', savedTheme === 'dark');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        // Inicializar tema al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
        });
    </script>
    <script src="js/shared/sidebar.js"></script>
</body>
</html>